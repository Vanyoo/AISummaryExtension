# 测试指南 - AI Element Selector

本指南提供了详细的测试流程和测试用例，确保扩展在各种场景下正常工作。

---

## 🧪 测试环境准备

### 浏览器测试矩阵

| 浏览器 | 版本 | 测试状态 | 备注 |
|--------|------|---------|------|
| Chrome | 120+ | ✅ 必测 | 主要目标浏览器 |
| Chrome | 88-119 | ⚠️ 兼容性测试 | 最低支持版本 |
| Edge | 120+ | ✅ 必测 | Chromium 内核 |
| Brave | 最新版 | ⚠️ 推荐测试 | 隐私保护浏览器 |
| Opera | 最新版 | ⚠️ 可选测试 | 测试兼容性 |

### 测试设备

- ✅ **Windows 10/11**（桌面）
- ✅ **macOS 10.15+**（桌面）
- ✅ **Linux (Ubuntu 20.04+)**（桌面）

### 测试网络环境

- 高速网络（用于测试流式输出）
- 慢速网络（测试超时处理）
- 断网环境（测试离线行为）

---

## 📋 测试清单

### 1️⃣ 安装测试

#### 测试步骤

1. **清理环境**
   ```bash
   # 卸载旧版本
   # 清除浏览器缓存
   # 关闭所有标签页
   ```

2. **执行安装**
   - 按照 [INSTALL.md](INSTALL.md) 的步骤安装
   - 记录每一步的结果

3. **验证安装**
   - 检查扩展列表
   - 检查工具栏图标
   - 检查控制台错误

#### 测试用例

| 用例编号 | 测试用例 | 预期结果 | 实际结果 |
|---------|---------|---------|---------|
| T-001 | 正常安装 | 扩展成功加载，无错误 | ☐ |
| T-002 | 重复安装 | 覆盖旧版本，无冲突 | ☐ |
| T-003 | 缺少文件安装 | 提示错误，不崩溃 | ☐ |
| T-004 | 权限同意 | 正常请求所有权限 | ☐ |

---

### 2️⃣ 配置测试

#### 测试步骤

1. **打开配置页面**
   - 右键扩展图标
   - 选择"选项"

2. **配置各项参数**
   - 测试每个配置项
   - 验证保存功能
   - 验证加载功能

3. **测试 API 连接**
   - 测试 Direct Mode
   - 测试 Proxy Mode
   - 测试 GM Bridge Mode

#### 测试用例

| 用例编号 | 测试用例 | 预期结果 | 实际结果 |
|---------|---------|---------|---------|
| T-101 | 保存配置 | 配置成功保存到 Storage | ☐ |
| T-102 | 加载配置 | 重启后配置正常加载 | ☐ |
| T-103 | 无效 API Key | 显示错误提示，不崩溃 | ☐ |
| T-104 | 空配置处理 | 使用默认值，正常运行 | ☐ |
| T-105 | Direct Mode 连接 | 成功调用 API | ☐ |
| T-106 | Proxy Mode 连接 | 成功通过代理调用 API | ☐ |
| T-107 | 测试连接功能 | 正确显示连接状态 | ☐ |

---

### 3️⃣ 功能测试

#### 3.1 元素选择测试

**测试网站**：
- 普通网站：https://example.com
- 技术文档：https://developer.mozilla.org
- 新闻网站：https://news.ycombinator.com
- 博客：https://medium.com

**测试用例**

| 用例编号 | 测试用例 | 预期结果 | 实际结果 |
|---------|---------|---------|---------|
| T-201 | 进入选择模式 | 浮层正常显示，鼠标样式改变 | ☐ |
| T-202 | 选择普通段落 | 正确提取文本内容 | ☐ |
| T-203 | 选择标题 | 正确提取标题文本 | ☐ |
| T-204 | 选择列表 | 正确提取所有列表项 | ☐ |
| T-205 | 选择代码块 | 正确提取代码内容 | ☐ |
| T-206 | 选择表格 | 正确提取表格内容 | ☐ |
| T-207 | 选择嵌套元素 | 递归提取所有文本 | ☐ |
| T-208 | 取消选择模式 | 浮层消失，恢复原始状态 | ☐ |
| T-209 | 重复点击"开始选择" | 无报错，可正常重复操作 | ☐ |
| T-210 | ESC 退出选择模式 | 正确退出选择模式 | ☐ |

#### 3.2 AI 总结测试

**测试输入**：
- 短文本（< 100 字符）
- 中等文本（100-1000 字符）
- 长文本（1000 字符以上）
- 包含特殊字符的文本
- 包含代码的文本
- 包含表格的文本

**测试用例**

| 用例编号 | 测试用例 | 预期结果 | 实际结果 |
|---------|---------|---------|---------|
| T-301 | 短文本总结 | 生成简洁总结 | ☐ |
| T-302 | 中等文本总结 | 生成结构化总结 | ☐ |
| T-303 | 长文本总结 | 生成详细摘要 | ☐ |
| T-304 | 特殊字符处理 | 正确处理 Unicode 字符 | ☐ |
| T-305 | 代码块总结 | 保留代码格式 | ☐ |
| T-306 | 表格总结 | 结构化提取表格内容 | ☐ |
| T-307 | API 超时处理 | 显示超时提示，不崩溃 | ☐ |
| T-308 | API 错误处理 | 显示错误信息，优雅降级 | ☐ |
| T-309 | 空输入处理 | 提示需要选择内容 | ☐ |

#### 3.3 Markdown 渲染测试

**测试格式**：

```markdown
# 标题
## 副标题

- 列表项 1
- 列表项 2
  - 子列表项

1. 有序列表 1
2. 有序列表 2

**粗体**
*斜体*

`代码`

```javascript
const x = 1;
```

> 引用

| 表头 1 | 表头 2 |
|--------|--------|
| 单元格 | 单元格 |
```

**测试用例**

| 用例编号 | 测试用例 | 预期结果 | 实际结果 |
|---------|---------|---------|---------|
| T-401 | 标题渲染 | 正确显示各级标题 | ☐ |
| T-402 | 列表渲染 | 正确显示有序和无序列表 | ☐ |
| T-403 | 代码块渲染 | 正确显示代码块和语法高亮 | ☐ |
| T-404 | 表格渲染 | 正确显示表格结构 | ☐ |
| T-405 | 链接渲染 | 正确显示可点击链接 | ☐ |
| T-406 | 图片渲染 | 正确显示图片 | ☐ |
| T-407 | 引用渲染 | 正确显示引用块 | ☐ |
| T-408 | 特殊字符渲染 | 正确转义 HTML 字符 | ☐ |
| T-409 | 渲染失败降级 | 显示纯文本，不崩溃 | ☐ |

#### 3.4 流式输出测试

**测试场景**：
- 高速网络
- 中速网络
- 慢速网络
- 网络抖动

**测试用例**

| 用例编号 | 测试用例 | 预期结果 | 实际结果 |
|---------|---------|---------|---------|
| T-501 | 流式输出正常 | 内容平滑加载，无跳动 | ☐ |
| T-502 | 长文本流式输出 | 无性能问题，页面流畅 | ☐ |
| T-503 | 快速开关窗口 | 正确处理防抖，无内存泄漏 | ☐ |
| T-504 | 网络中断处理 | 停止加载，显示提示 | ☐ |
| T-505 | 网络恢复处理 | 不影响已加载内容 | ☐ |

---

### 4️⃣ UI/UX 测试

#### 测试用例

| 用例编号 | 测试用例 | 预期结果 | 实际结果 |
|---------|---------|---------|---------|
| T-601 | 窗口拖拽 | 拖拽窗口成功移动 | ☐ |
| T-602 | 窗口调整大小 | 四个角和边框可调整大小 | ☐ |
| T-603 | 窗口固定位置 | 固定后不自动移动 | ☐ |
| T-604 | 双击最大化 | 双击标题栏最大化/恢复 | ☐ |
| T-605 | 窗口边界检查 | 不会移出屏幕可视区域 | ☐ |
| T-606 | 按钮响应 | 所有按钮点击有响应 | ☐ |
| T-607 | 图标正确显示 | 所有图标正常加载 | ☐ |
| T-608 | 动画流畅 | 所有动画过渡平滑 | ☐ |
| T-609 | 颜色对比度 | 符合无障碍标准 | ☐ |
| T-610 | 响应式布局 | 不同屏幕尺寸正常显示 | ☐ |

---

### 5️⃣ Shadow DOM 测试

**测试网站**：
- 使用 Shadow DOM 的网站
- Polymer 组件网站
- Web Components 网页

**测试用例**

| 用例编号 | 测试用例 | 预期结果 | 实际结果 |
|---------|---------|---------|---------|
| T-701 | 选择 Shadow DOM 内元素 | 正确提取内容 | ☐ |
| T-702 | 深度嵌套 Shadow DOM | 递归查找并提取 | ☐ |
| T-703 | 多个 Shadow Root | 正确处理多个 Shadow Root | ☐ |
| T-704 | Closed Shadow DOM | 优雅处理 closed 模式 | ☐ |

---

### 6️⃣ 性能测试

#### 内存测试

| 用例编号 | 测试用例 | 预期结果 | 实际结果 |
|---------|---------|---------|---------|
| T-801 | 长时间运行（1小时） | 内存无明显增长 | ☐ |
| T-802 | 重复使用（100次） | 无内存泄漏 | ☐ |
| T-803 | 大标签页使用 | 不影响其他标签页性能 | ☐ |

#### 性能指标

| 指标 | 目标值 | 实际值 | 通过 |
|------|--------|--------|------|
| 加载时间 | < 100ms | - | ☐ |
| 渲染延迟 | < 50ms | - | ☐ |
| 内存占用 | < 50MB | - | ☐ |

---

### 7️⃣ 兼容性测试

#### 网站兼容性

**测试列表**：
- [ ] https://google.com
- [ ] https://github.com
- [ ] https://stackoverflow.com
- [ ] https://medium.com
- [ ] https://developer.mozilla.org
- [ ] https://news.ycombinator.com
- [ ] https://reddit.com
- [ ] https://wikipedia.org
- [ ] https://youtube.com
- [ ] https://twitter.com

#### 浏览器兼容性

| 浏览器 | 版本 | 结果 | 备注 |
|--------|------|------|------|
| Chrome | 120+ | ☐ | |
| Chrome | 88-119 | ☐ | |
| Edge | 120+ | ☐ | |
| Brave | 最新版 | ☐ | |
| Opera | 最新版 | ☐ | |

---

### 8️⃣ 安全测试

#### 测试用例

| 用例编号 | 测试用例 | 预期结果 | 实际结果 |
|---------|---------|---------|---------|
| T-901 | XSS 攻击防护 | 正确转义用户输入 | ☐ |
| T-902 | API Key 存储 | 安全存储在 Storage | ☐ |
| T-903 | 跨域请求处理 | 符合 CORS 策略 | ☐ |
| T-904 | 权限边界 | 不访问未授权网站 | ☐ |
| T-905 | 内容脚本隔离 | 不污染全局变量 | ☐ |

---

## 📊 测试报告模板

### 测试总结

```
测试日期：_________
测试人员：_________
浏览器版本：_________
扩展版本：1.0.0

测试用例总数：_____
通过：_____
失败：_____
跳过：_____

通过率：_____%

关键问题：
1. _______________
2. _______________
3. _______________
```

### 问题报告模板

```
问题编号：BUG-___
严重程度：□ P0 - 致命  □ P1 - 严重  □ P2 - 一般  □ P3 - 轻微
问题标题：_______________

复现步骤：
1. _______________
2. _______________
3. _______________

预期结果：_______________
实际结果：_______________

环境：
- 浏览器：_________
- 版本：_________
- 操作系统：_________

附件：
- 截图
- 控制台日志
```

---

## 🚀 自动化测试（可选）

### 单元测试示例

```javascript
// 测试配置管理
describe('Config Management', () => {
  test('should save config to storage', async () => {
    const config = { apiKey: 'test123' };
    await saveConfig(config);
    const loaded = await loadConfig();
    expect(loaded.apiKey).toBe('test123');
  });
});

// 测试文本提取
describe('Text Extraction', () => {
  test('should extract text from simple element', () => {
    const div = document.createElement('div');
    div.textContent = 'Hello World';
    const text = extractText(div);
    expect(text).toBe('Hello World');
  });
});
```

### E2E 测试脚本

```javascript
// 使用 Puppeteer 进行 E2E 测试
const puppeteer = require('puppeteer');

(async () => {
  const browser = await puppeteer.launch();
  const page = await browser.newPage();

  // 加载扩展
  await page.goto('chrome://extensions');
  // ... 加载扩展的步骤

  // 测试功能
  await page.goto('https://example.com');
  // ... 点击按钮，选择元素等

  await browser.close();
})();
```

---

## ✅ 发布前最终检查

在发布前，请完成以下检查：

- [ ] 所有 P0 和 P1 问题已修复
- [ ] 测试通过率 ≥ 95%
- [ ] 主要浏览器兼容性验证通过
- [ ] 性能指标达标
- [ ] 文档完整准确
- [ ] 版本号正确更新
- [ ] CHANGELOG.md 已更新
- [ ] README.md 已更新
- [ ] 安装包大小合理
- [ ] 无安全漏洞

---

## 📞 测试问题反馈

如发现测试问题，请按以下步骤反馈：

1. **记录详细信息**
   - 浏览器版本
   - 扩展版本
   - 复现步骤
   - 错误截图
   - 控制台日志

2. **提交 Issue**
   - 访问 [GitHub Issues](https://github.com/yourusername/AI-element-selector/issues)
   - 使用问题报告模板
   - 附上必要的附件

3. **等待确认**
   - 开发团队会在 24 小时内确认
   - 严重问题会优先处理

---

<div align="center">

**感谢你的测试工作！🙏**

[返回测试清单](#测试清单) | [查看安装指南](INSTALL.md)

</div>